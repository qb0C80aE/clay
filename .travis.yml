language: go
go: "1.11.2"

notifications:
 email: false

before_install:
 - go version
 - sudo apt-get -qq update

install:
 - go get -u github.com/golang/dep/cmd/dep
 - go get -u github.com/jessevdk/go-assets-builder
script:
 - dep ensure
 - CLAY_ASSET_MODE=internal BUILD_ASSET=true BUILD_ASSET_SOURCE=../bastet CLAY_CONFIG_FILE_PATH=bastet/clay_config.json go generate -tags=prebuild prebuild/generate.go
 - CGO_ENABLED=1 GOOS=linux GOARCH=amd64 go build -a -tags "netgo sqlite_omit_load_extension" --ldflags '-extldflags "-static"' -o linux_amd64/clay

after_success:
 - (cd linux_amd64; tar zcvf ../clay.bastet.linux-amd64.tgz clay)
 - ls -la
 - ./upload.sh

